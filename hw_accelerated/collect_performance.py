import subprocess
import os
import sys

lut_size = 8
prime_suite = [36542047, 36542071, 36542137, 36542173, 36542179, 36542183, 36542201, 36542213, 36542227, 365956819, 365420507, 365420513, 365420519, 365420537, 365420557, 365420569, 365420581, 365420617, 3654205081, 3654205091, 3654205099, 3654205103, 3654205111, 3654205189, 3654205249, 3654205273, 3654205283, 36542050711, 36542050733, 36542050739, 36542050759, 36542050799, 36542050807, 36542050813, 36542050861, 36542050871]
highly_composite_suite = [1124388064800, 1606268664000, 1686582097200, 1927522396800, 2248776129600, 3212537328000, 3373164194400, 4497552259200, 6746328388800, 8995104518400, 9316358251200, 13492656777600, 18632716502400, 26985313555200, 27949074753600, 32607253879200, 46581791256000, 48910880818800, 55898149507200, 65214507758400, 93163582512000, 97821761637600, 130429015516800, 195643523275200, 260858031033600, 288807105787200, 391287046550400, 577614211574400, 782574093100800, 866421317361600, 1010824870255200, 1444035528936000, 1516237305382800, 1732842634723200, 2021649740510400, 2888071057872000, 3032474610765600, 4043299481020800, 6064949221531200, 8086598962041600, 10108248702552000, 12129898443062400, 18194847664593600, 20216497405104000, 24259796886124800, 30324746107656000, 36389695329187200, 48519593772249600, 60649492215312000, 72779390658374400, 74801040398884800, 106858629141264000, 112201560598327200, 149602080797769600, 224403121196654400, 299204161595539200, 374005201994424000, 448806242393308800, 673209363589963200, 748010403988848000, 897612484786617600]
test_suite = prime_suite

if "--rebuild" in sys.argv[1:]:
    subprocess.run(["make", "cleanall"])
    subprocess.run(["make", "run", "TARGET=hw", f"CIRCUIT=../benchmarks/multiplier_factorize/multiplier_{test_suite[0]}_sat.eqn", "SAT=sat"])

try:
    os.remove("csat.log")
except OSError:
    pass

subprocess.run(["bash", "clean.sh"], cwd="../benchmarks/multiplier_factorize")
for product in [test_suite[0]] + test_suite: # repeat first to ensure bitstream is loaded and cache is "warm"
    subprocess.run(["python3", "generate_factorize_benchmark.py", f"{product}", f"{lut_size}"], cwd="../benchmarks/multiplier_factorize")
    subprocess.run(["make", "test", "TARGET=hw", f"CIRCUIT=../benchmarks/multiplier_factorize/multiplier_{product}_sat.eqn", "SAT=sat"])
